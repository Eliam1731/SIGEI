
UPDATE ejemplo de JSON

{
    "Fecha_compra":
    "Fecha_garantía": 
    "Importe": 
    "Especificación": 
    "Comentarios": 
    "Service_tag": 
    "N_referencia_Compras":
    "MAC_Ethernet": 
    "MAC_WIFI":
}

equipment_expense ejemplo JSON

{
    "Equipo_id": 1,
    "Cantidad": ,
    "Piezas": "Disco duro SSD",
    "Fecha": "2022-01-01",
    "Recibo_pdf": "base64 del recibo en pdf"
}

Delete_img ejemplo JSON

{
    "Equipo_id": 1,
    "Imagen_id": 2
}

codigo para modificar la tabla de gastos
    ALTER TABLE `gastos_de_los_equipos`
    MODIFY `Recibo_pdf` MEDIUMBLOB NOT NULL;

.....
{
    "equipo_id": 1,
    "user_id": 2,
    "motivo_baja": "El equipo está obsoleto"


}


modificacion de tablas sql:

ALTER TABLE `resguardos_de_equipos`
MODIFY COLUMN `Fecha_autorizacion` date NOT NULL;

la manera en la que debes mandarme las fechas es de la seguiente 

Asi 2024-03-04 no asi 2024/03/04
Manera correcta: 2024-03-04 
Manera incorrecta: 2020/03/04

modificacion tabla sql para la fecha de garantia:

ALTER TABLE equipos_informaticos MODIFY Fecha_garantia date DEFAULT NULL;


sincronia en los php

mi front me mandara este objeto:

    const maintenanceInit = {
      fechaInicio: currentDate,
      horaInicio: currentTime,
      resguardante: protective,
      equipo: device,
      materialRequerido: { herramientas: tools, otros: othersToolValue },
      usuario: user,
    }

Ejemplo de información:

{
    "fechaInicio": "15/05/2024",
    "horaInicio": "10:50 AM",
    "resguardante": null,
    "equipo": 13,
    "materialRequerido": {
        "herramientas": [
            "material1",
            "material2"
        ],
        "otros": "Martillo de goma"
    },
    "usuario": "jperezhidalgo@grupoopc.com"
}


Importe validar que solo sean numeros (listo)

Solo dar de baja esquipos que esten disponibles (listo)

Seccion de autorizar resguardos devolver todos los datos del equipo  (listo)

Crear un php donde haga una cuenta de todos los equipos informaticos (listo)

Crear un php donde haga una cuenta de los que estan en mantenimiento (listo)

Crear un php donde haga una cuenta de los que estan en Disponible (listo)

Crear un php donde haga una cuenta de los que estan en resguardo (listo)


codigo sql para la nueva columna:
ALTER TABLE `equipos_informaticos`
ADD `num_telefono` varchar(15) DEFAULT NULL;


ALTER TABLE `equipos_informaticos`
MODIFY `Fecha_compra` date DEFAULT NULL,
MODIFY `Fecha_garantia` date DEFAULT NULL,
MODIFY `Num_ref_compaq` varchar(100) DEFAULT NULL,
MODIFY `Comentarios` text DEFAULT NULL;

ALTER TABLE `equipos_informaticos`
DROP INDEX `ref_compac`;

ALTER TABLE `empleados_resguardantes`
DROP INDEX `num_ssocial`;

ALTER TABLE `baja_de_equipos`
MODIFY `Fecha_baja` DATE NOT NULL;

<?php
use PHPMailer\PHPMailer\PHPMailer;
use PHPMailer\PHPMailer\Exception;

require '../data/vendor/autoload.php';
include '../config/connection_db.php';

header('Content-Type: application/json');

try {
    // Obtén los datos del front
    $data = json_decode(file_get_contents('php://input'), true);
    $equipo_id = $data['equipo_id'];
    $correo = $data['correo'];
    $comentario = $data['comentario'];
    $fecha_baja = $data['fecha_baja']; 

    // Formatea la fecha
    $fecha_baja_formateada = date('Y-m-d H:i:s', strtotime($fecha_baja));

    // Verifica si el equipo ya está en baja o si su estado es distinto de 1
    $stmt = $conn->prepare("SELECT Status_id FROM equipos_informaticos WHERE Equipo_id = :equipo_id");
    $stmt->execute(['equipo_id' => $equipo_id]);
    $row = $stmt->fetch();
    if ($row['Status_id'] == 4) {
        echo json_encode(['error' => 'El equipo ya se encuentra en baja']);
        exit();
    } elseif ($row['Status_id'] != 1) {
        echo json_encode(['error' => 'El equipo no está disponible para dar de baja']);
        exit();
    }

    // Cambia el estado del equipo a 4
    $stmt = $conn->prepare("UPDATE equipos_informaticos SET Status_id = 4 WHERE Equipo_id = :equipo_id");
    $stmt->execute(['equipo_id' => $equipo_id]);

    // Registra la baja en la tabla baja_de_equipos
    $stmt = $conn->prepare("INSERT INTO baja_de_equipos (Equipo_id, User_id, Fecha_baja, Motivo_baja) VALUES (:equipo_id, (SELECT User_id FROM usuarios WHERE correo_electronico = :correo), :fecha_baja, :comentario)");
    $stmt->execute(['equipo_id' => $equipo_id, 'correo' => $correo, 'fecha_baja' => $fecha_baja_formateada, 'comentario' => $comentario]);

    $mail = new PHPMailer(true);

    // Configuración del servidor
    $mail->SMTPDebug = 0;                                 
    $mail->isSMTP();                                      
    $mail->Host       = 'smtp.ionos.mx';  
    $mail->SMTPAuth   = true;                              
    $mail->Username   = 'sistemas@grupoopc.com ';                
    $mail->Password   = 'Sistemasopc#1';                          
    $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;    
    $mail->Port       = 587;                               

    // Recipientes
    $mail->setFrom('sistemas@grupoopc.com', 'sistemas');
    $mail->addAddress('egutierrez@grupoopc.com');
    $mail->addAddress('becariosistemas1@grupoopc.com'); 

    // Contenido
    $mail->isHTML(true);                                  
    $mail->Subject = 'Baja de equipo informático';
    $mail->Body    = "El equipo con ID $equipo_id ha sido dado de baja. Motivo: $comentario";
    $mail->AltBody = "El equipo con ID $equipo_id ha sido dado de baja. Motivo: $comentario";

    $mail->send();
    echo json_encode(['message' => 'El equipo ha sido dado de baja y el correo ha sido enviado']);
} catch (Exception $e) {
    http_response_code(500);
    echo json_encode(['error' => "No se pudo procesar la solicitud. Error: {$e->getMessage()}"]);
}
?>



INSERT INTO `frente` (`numero_frente`, `Nom_frente`) VALUES
(621, 'Direccion General'),
(622, 'Gerencia de Calidad, Seg. y M.A.'),
(631, 'Direccion de Admon y Finanzas'),
(632, 'Fiscal'),
(635, 'Contabilidad'),
(636, 'Sistemas'),
(637, 'Tesoreria'),
(642, 'Control de Proyectos'),
(644, 'Concursos'),
(651, 'Dirección de Comercialización'),
(646, 'Gerencia de Construcion'),
(638, 'Juridico'),
(634, 'Compras'),
(639, 'Almacen'),
(663, 'Oficina Xalapa'),
(633, 'Recursos Humanos');
